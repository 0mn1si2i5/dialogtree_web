<template>
  <div class="session-sidebar">
    <!-- È°πÁõÆLogoÂå∫Âüü -->
    <div class="logo-header">
      <div class="logo-content">
        <div class="logo-icon">üå≥</div>
        <span class="logo-text">DialogTree</span>
      </div>
    </div>
    
    <!-- Ê†áÁ≠æÈ°µÂ∑•ÂÖ∑Ê†è -->
    <div class="sidebar-header">
      <a-tabs v-model:active-key="activeTab" size="small" class="sidebar-tabs">
        <div class="tabs">
          <a-tab-pane key="sessions" title="‰ºöËØùÂàóË°®" />
          <a-tab-pane key="categories" title="ÂàÜÁ±ªÁÆ°ÁêÜ" />
        </div>
      </a-tabs>
    </div>

    <!-- ‰ºöËØùÂàóË°®Ê†áÁ≠æÈ°µ -->
    <div v-if="activeTab === 'sessions'" class="tab-content">
      <!-- ÂàÜÁ±ªÁ≠õÈÄâ -->
      <div class="category-filter">
        <a-select
          v-model="selectedCategoryId"
          placeholder="ÈÄâÊã©ÂàÜÁ±ª"
          allow-clear
          @change="handleCategoryChange"
          @clear="handleCategoryClear"
        >
          <a-option value="all">ÂÖ®ÈÉ®ÂàÜÁ±ª</a-option>
          <a-option 
            v-for="category in categories"
            :key="category.id"
            :value="category.id"
          >
            {{ category.name }}
          </a-option>
        </a-select>
      </div>

      <!-- ‰ºöËØùÂàóË°® -->
      <div class="session-list">
        <a-spin :loading="sessionStore.loading">
          <div 
            v-for="session in filteredSessions"
            :key="session.id"
            class="session-item"
            :class="{ active: session.id === currentSessionId }"
            @click="selectSession(session.id)"
          >
            <div class="session-info">
              <div class="session-title" :title="session.title">
                {{ session.title }}
              </div>
              <div class="session-meta">
                <span class="session-time">
                  {{ formatTime(session.updatedAt) }}
                </span>
                <span v-if="session.summary" class="session-summary">
                  {{ session.summary }}
                </span>
              </div>
            </div>
            
            <a-dropdown trigger="click" @select="(key: string) => handleSessionAction(key, session)">
              <a-button type="text" size="mini" @click.stop>
                <template #icon>
                  <icon-more />
                </template>
              </a-button>
              <template #content>
                <a-doption value="rename">ÈáçÂëΩÂêç</a-doption>
                <a-doption value="move">ÁßªÂä®Âà∞ÂàÜÁ±ª</a-doption>
                <a-doption value="delete" class="danger">Âà†Èô§</a-doption>
              </template>
            </a-dropdown>
          </div>
          
          <a-empty 
            v-if="filteredSessions.length === 0 && !sessionStore.loading"
            description="ÊöÇÊó†‰ºöËØù"
          />
        </a-spin>
      </div>
      
      <!-- Â∫ïÈÉ®Êñ∞Âª∫‰ºöËØùÊåâÈíÆ -->
      <div class="session-footer">
        <a-button 
          type="primary" 
          size="medium"
          block
          @click="showCreateSessionModal = true"
        >
          Êñ∞Âª∫‰ºöËØù
        </a-button>
      </div>
    </div>

    <!-- ÂàÜÁ±ªÁÆ°ÁêÜÊ†áÁ≠æÈ°µ -->
    <div v-if="activeTab === 'categories'" class="tab-content">
      <div class="category-actions">
        <a-button 
          type="primary" 
          size="small" 
          @click="showCreateCategoryModal = true"
        >
          Êñ∞Âª∫ÂàÜÁ±ª
        </a-button>
      </div>

      <div class="category-list">
        <a-spin :loading="sessionStore.loading">
          <div 
            v-for="category in categories"
            :key="category.id"
            class="category-item"
          >
            <div class="category-info">
              <div class="category-name">{{ category.name }}</div>
              <div class="category-count">
                {{ getSessionCountByCategory(category.id) }} ‰∏™‰ºöËØù
              </div>
            </div>
            
            <a-dropdown trigger="click" @select="(key: string) => handleCategoryAction(key, category)">
              <a-button type="text" size="mini">
                <template #icon>
                  <icon-more />
                </template>
              </a-button>
              <template #content>
                <a-doption value="rename">ÈáçÂëΩÂêç</a-doption>
                <a-doption value="delete" class="danger">Âà†Èô§</a-doption>
              </template>
            </a-dropdown>
          </div>
          
          <a-empty 
            v-if="categories.length === 0 && !sessionStore.loading"
            description="ÊöÇÊó†ÂàÜÁ±ª"
          />
        </a-spin>
      </div>
    </div>

    <!-- Êñ∞Âª∫‰ºöËØùÊ®°ÊÄÅÊ°Ü -->
    <a-modal
      v-model:visible="showCreateSessionModal"
      title="Êñ∞Âª∫‰ºöËØù"
      @ok="handleCreateSession"
      @cancel="resetCreateSessionForm"
    >
      <a-form :model="createSessionForm" layout="vertical">
        <a-form-item label="‰ºöËØùÊ†áÈ¢ò" required>
          <a-input 
            v-model="createSessionForm.title" 
            placeholder="ËØ∑ËæìÂÖ•‰ºöËØùÊ†áÈ¢ò"
            @keyup.enter="handleCreateSession"
          />
        </a-form-item>
        <a-form-item label="ÈÄâÊã©ÂàÜÁ±ª" required>
          <a-select v-model="createSessionForm.categoryID" placeholder="ÈÄâÊã©ÂàÜÁ±ª">
            <a-option 
              v-for="category in categories"
              :key="category.id"
              :value="category.id"
            >
              {{ category.name }}
            </a-option>
          </a-select>
        </a-form-item>
      </a-form>
    </a-modal>

    <!-- Êñ∞Âª∫ÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü -->
    <a-modal
      v-model:visible="showCreateCategoryModal"
      title="Êñ∞Âª∫ÂàÜÁ±ª"
      @ok="handleCreateCategory"
      @cancel="resetCreateCategoryForm"
    >
      <a-form :model="createCategoryForm" layout="vertical">
        <a-form-item label="ÂàÜÁ±ªÂêçÁß∞" required>
          <a-input 
            v-model="createCategoryForm.name" 
            placeholder="ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞"
            @keyup.enter="handleCreateCategory"
          />
        </a-form-item>
      </a-form>
    </a-modal>

    <!-- ‰ºöËØùÈáçÂëΩÂêçÊ®°ÊÄÅÊ°Ü -->
    <a-modal
      v-model:visible="showRenameSessionModal"
      title="ÈáçÂëΩÂêç‰ºöËØù"
      @ok="handleRenameSession"
      @cancel="resetRenameSessionForm"
    >
      <a-form :model="renameSessionForm" layout="vertical">
        <a-form-item label="‰ºöËØùÊ†áÈ¢ò" required>
          <a-input 
            v-model="renameSessionForm.title" 
            placeholder="ËØ∑ËæìÂÖ•Êñ∞ÁöÑ‰ºöËØùÊ†áÈ¢ò"
            @keyup.enter="handleRenameSession"
          />
        </a-form-item>
      </a-form>
    </a-modal>

    <!-- ‰ºöËØù‰øÆÊîπÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü -->
    <a-modal
      v-model:visible="showMoveSessionModal"
      title="‰øÆÊîπÂàÜÁ±ª"
      @ok="handleMoveSession"
      @cancel="resetMoveSessionForm"
    >
      <a-form :model="moveSessionForm" layout="vertical">
        <a-form-item label="ÈÄâÊã©ÂàÜÁ±ª" required>
          <a-select v-model="moveSessionForm.categoryID" placeholder="ÈÄâÊã©Êñ∞ÁöÑÂàÜÁ±ª">
            <a-option 
              v-for="category in categories"
              :key="category.id"
              :value="category.id"
            >
              {{ category.name }}
            </a-option>
          </a-select>
        </a-form-item>
      </a-form>
    </a-modal>

    <!-- ÂàÜÁ±ªÈáçÂëΩÂêçÊ®°ÊÄÅÊ°Ü -->
    <a-modal
      v-model:visible="showRenameCategoryModal"
      title="ÈáçÂëΩÂêçÂàÜÁ±ª"
      @ok="handleRenameCategory"
      @cancel="resetRenameCategoryForm"
    >
      <a-form :model="renameCategoryForm" layout="vertical">
        <a-form-item label="ÂàÜÁ±ªÂêçÁß∞" required>
          <a-input 
            v-model="renameCategoryForm.name" 
            placeholder="ËØ∑ËæìÂÖ•Êñ∞ÁöÑÂàÜÁ±ªÂêçÁß∞"
            @keyup.enter="handleRenameCategory"
          />
        </a-form-item>
      </a-form>
    </a-modal>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { Message, Modal } from '@arco-design/web-vue'
import { useSessionStore, useDialogStore, useLayoutStore } from '@/stores'
import { 
  IconMore 
} from '@arco-design/web-vue/es/icon'
import dayjs from 'dayjs'
import type { Session, Category } from '@/types'

// ‰ΩøÁî®stores
const sessionStore = useSessionStore()
const dialogStore = useDialogStore()
const layoutStore = useLayoutStore()

// ÂìçÂ∫îÂºèÁä∂ÊÄÅ
const activeTab = ref('sessions')
const selectedCategoryId = ref<number | string | null>(null)
const showCreateSessionModal = ref(false)
const showCreateCategoryModal = ref(false)
const showRenameSessionModal = ref(false)
const showMoveSessionModal = ref(false)
const showRenameCategoryModal = ref(false)

// Ë°®ÂçïÊï∞ÊçÆ
const createSessionForm = ref({
  title: '',
  categoryID: null as number | null,
})

const createCategoryForm = ref({
  name: '',
})

const renameSessionForm = ref({
  sessionId: null as number | null,
  title: '',
})

const moveSessionForm = ref({
  sessionId: null as number | null,
  categoryID: null as number | null,
})

const renameCategoryForm = ref({
  categoryId: null as number | null,
  name: '',
})

// ËÆ°ÁÆóÂ±ûÊÄß
const currentSessionId = computed(() => sessionStore.currentSessionId)
const categories = computed(() => sessionStore.categories)
const filteredSessions = computed(() => sessionStore.filteredSessions)

// ÁõëÂê¨ÂàÜÁ±ªÈÄâÊã©ÂèòÂåñ
watch(selectedCategoryId, (newCategoryId) => {
  if (newCategoryId === 'all') {
    sessionStore.setSelectedCategory(null)
  } else {
    sessionStore.setSelectedCategory(newCategoryId as number)
  }
})

// ===== ÊñπÊ≥ï =====

// Ê†ºÂºèÂåñÊó∂Èó¥
function formatTime(timeStr: string): string {
  return dayjs(timeStr).format('MM-DD HH:mm')
}

// Ëé∑ÂèñÂàÜÁ±ª‰∏ãÁöÑ‰ºöËØùÊï∞Èáè
function getSessionCountByCategory(categoryId: number): number {
  return sessionStore.sessions.filter(s => s.categoryID === categoryId).length
}

// ÈÄâÊã©‰ºöËØù
async function selectSession(sessionId: number) {
  try {
    sessionStore.setCurrentSession(sessionId)
    await dialogStore.fetchDialogTree(sessionId)
  } catch (error) {
    Message.error('Âä†ËΩΩ‰ºöËØùÂ§±Ë¥•')
  }
}

// ÂàÜÁ±ªÁ≠õÈÄâÂèòÂåñ
async function handleCategoryChange(categoryId: number | string) {
  if (categoryId !== 'all') {
    try {
      await sessionStore.fetchSessionsByCategory(categoryId as number)
    } catch (error) {
      // ÈôçÁ∫ßÂ§ÑÁêÜÂ∑≤Âú®store‰∏≠ÂÆûÁé∞
    }
  }
}

// Ê∏ÖÈô§ÂàÜÁ±ªÁ≠õÈÄâ
function handleCategoryClear() {
  selectedCategoryId.value = null
}

// ‰ºöËØùÊìç‰Ωú
function handleSessionAction(action: string, session: Session) {
  switch (action) {
    case 'rename':
      showRenameSessionDialog(session)
      break
    case 'move':
      showMoveSessionDialog(session)
      break
    case 'delete':
      confirmDeleteSession(session)
      break
  }
}

// ÂàÜÁ±ªÊìç‰Ωú
function handleCategoryAction(action: string, category: Category) {
  switch (action) {
    case 'rename':
      showRenameCategoryDialog(category)
      break
    case 'delete':
      confirmDeleteCategory(category)
      break
  }
}

// Á°ÆËÆ§Âà†Èô§‰ºöËØù
function confirmDeleteSession(session: Session) {
  Modal.confirm({
    title: 'Á°ÆËÆ§Âà†Èô§',
    content: `Á°ÆÂÆöË¶ÅÂà†Èô§‰ºöËØù"${session.title}"ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`,
    onOk: async () => {
      try {
        await sessionStore.deleteSession(session.id)
        Message.success('Âà†Èô§ÊàêÂäü')
      } catch (error) {
        Message.error('Âà†Èô§Â§±Ë¥•')
      }
    }
  })
}

// Á°ÆËÆ§Âà†Èô§ÂàÜÁ±ª
function confirmDeleteCategory(category: Category) {
  const sessionCount = getSessionCountByCategory(category.id)
  if (sessionCount > 0) {
    Message.warning(`ËØ•ÂàÜÁ±ª‰∏ãËøòÊúâ ${sessionCount} ‰∏™‰ºöËØùÔºåËØ∑ÂÖàÁßªÂä®ÊàñÂà†Èô§Ëøô‰∫õ‰ºöËØù`)
    return
  }

  Modal.confirm({
    title: 'Á°ÆËÆ§Âà†Èô§',
    content: `Á°ÆÂÆöË¶ÅÂà†Èô§ÂàÜÁ±ª"${category.name}"ÂêóÔºü`,
    onOk: async () => {
      try {
        await sessionStore.deleteCategory(category.id)
        Message.success('Âà†Èô§ÊàêÂäü')
      } catch (error) {
        Message.error('Âà†Èô§Â§±Ë¥•')
      }
    }
  })
}

// ÂàõÂª∫‰ºöËØù
async function handleCreateSession() {
  if (!createSessionForm.value.title?.trim()) {
    Message.warning('ËØ∑ËæìÂÖ•‰ºöËØùÊ†áÈ¢ò')
    return
  }
  if (!createSessionForm.value.categoryID) {
    Message.warning('ËØ∑ÈÄâÊã©ÂàÜÁ±ª')
    return
  }

  try {
    await sessionStore.createSession(
      createSessionForm.value.title.trim(),
      createSessionForm.value.categoryID
    )
    Message.success('ÂàõÂª∫ÊàêÂäü')
    showCreateSessionModal.value = false
    resetCreateSessionForm()
  } catch (error) {
    Message.error('ÂàõÂª∫Â§±Ë¥•')
  }
}

// ÂàõÂª∫ÂàÜÁ±ª
async function handleCreateCategory() {
  if (!createCategoryForm.value.name?.trim()) {
    Message.warning('ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞')
    return
  }

  try {
    await sessionStore.createCategory(createCategoryForm.value.name.trim())
    Message.success('ÂàõÂª∫ÊàêÂäü')
    showCreateCategoryModal.value = false
    resetCreateCategoryForm()
  } catch (error) {
    Message.error('ÂàõÂª∫Â§±Ë¥•')
  }
}

// ÈáçÁΩÆË°®Âçï
function resetCreateSessionForm() {
  createSessionForm.value = {
    title: '',
    categoryID: null,
  }
}

function resetCreateCategoryForm() {
  createCategoryForm.value = {
    name: '',
  }
}

// ÊòæÁ§∫‰ºöËØùÈáçÂëΩÂêçÂØπËØùÊ°Ü
function showRenameSessionDialog(session: Session) {
  renameSessionForm.value = {
    sessionId: session.id,
    title: session.title,
  }
  showRenameSessionModal.value = true
}

// ÊòæÁ§∫‰ºöËØùÁßªÂä®ÂàÜÁ±ªÂØπËØùÊ°Ü
function showMoveSessionDialog(session: Session) {
  moveSessionForm.value = {
    sessionId: session.id,
    categoryID: session.categoryID,
  }
  showMoveSessionModal.value = true
}

// ÊòæÁ§∫ÂàÜÁ±ªÈáçÂëΩÂêçÂØπËØùÊ°Ü
function showRenameCategoryDialog(category: Category) {
  renameCategoryForm.value = {
    categoryId: category.id,
    name: category.name,
  }
  showRenameCategoryModal.value = true
}

// Â§ÑÁêÜ‰ºöËØùÈáçÂëΩÂêç
async function handleRenameSession() {
  if (!renameSessionForm.value.title?.trim() || !renameSessionForm.value.sessionId) {
    Message.warning('ËØ∑ËæìÂÖ•‰ºöËØùÊ†áÈ¢ò')
    return
  }

  try {
    const sessionId = renameSessionForm.value.sessionId
    const currentSession = sessionStore.sessions.find(s => s.id === sessionId)
    if (!currentSession) {
      Message.error('‰ºöËØù‰∏çÂ≠òÂú®')
      return
    }

    await sessionStore.updateSession(sessionId, {
      title: renameSessionForm.value.title.trim(),
      categoryID: currentSession.categoryID,
    })
    
    Message.success('ÈáçÂëΩÂêçÊàêÂäü')
    showRenameSessionModal.value = false
    resetRenameSessionForm()
  } catch (error) {
    Message.error('ÈáçÂëΩÂêçÂ§±Ë¥•')
  }
}

// Â§ÑÁêÜ‰ºöËØùÁßªÂä®ÂàÜÁ±ª
async function handleMoveSession() {
  if (!moveSessionForm.value.categoryID || !moveSessionForm.value.sessionId) {
    Message.warning('ËØ∑ÈÄâÊã©ÂàÜÁ±ª')
    return
  }

  try {
    const sessionId = moveSessionForm.value.sessionId
    const currentSession = sessionStore.sessions.find(s => s.id === sessionId)
    if (!currentSession) {
      Message.error('‰ºöËØù‰∏çÂ≠òÂú®')
      return
    }

    await sessionStore.updateSession(sessionId, {
      title: currentSession.title,
      categoryID: moveSessionForm.value.categoryID,
    })
    
    Message.success('ÁßªÂä®ÊàêÂäü')
    showMoveSessionModal.value = false
    resetMoveSessionForm()
  } catch (error) {
    Message.error('ÁßªÂä®Â§±Ë¥•')
  }
}

// Â§ÑÁêÜÂàÜÁ±ªÈáçÂëΩÂêç
async function handleRenameCategory() {
  if (!renameCategoryForm.value.name?.trim() || !renameCategoryForm.value.categoryId) {
    Message.warning('ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞')
    return
  }

  try {
    await sessionStore.updateCategory(
      renameCategoryForm.value.categoryId,
      renameCategoryForm.value.name.trim()
    )
    
    Message.success('ÈáçÂëΩÂêçÊàêÂäü')
    showRenameCategoryModal.value = false
    resetRenameCategoryForm()
  } catch (error) {
    Message.error('ÈáçÂëΩÂêçÂ§±Ë¥•')
  }
}

// ÈáçÁΩÆË°®Âçï
function resetRenameSessionForm() {
  renameSessionForm.value = {
    sessionId: null,
    title: '',
  }
}

function resetMoveSessionForm() {
  moveSessionForm.value = {
    sessionId: null,
    categoryID: null,
  }
}

function resetRenameCategoryForm() {
  renameCategoryForm.value = {
    categoryId: null,
    name: '',
  }
}

</script>

<style lang="less" scoped>
.session-sidebar {
  display: flex;
  flex-direction: column;
  height: 100%;
  background-color: #fff;
  overflow-x: hidden; // Á¶ÅÊ≠¢Ê∞¥Âπ≥ÊªöÂä®
  width: 100%;
  box-sizing: border-box;
}

.logo-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px 16px; // ‰∏éÂè≥‰æßÂ∑•ÂÖ∑Ê†è‰∏ÄËá¥
  border-bottom: 1px solid #e5e5e5;
  background-color: #fff;
  flex-shrink: 0;
  min-height: 48px; // ‰∏éÂè≥‰æßÂ∑•ÂÖ∑Ê†èÈ´òÂ∫¶ÂåπÈÖç
}

.logo-content {
  display: flex;
  align-items: center;
  gap: 8px;
}

.logo-icon {
  font-size: 24px;
  line-height: 1;
}

.logo-text {
  font-size: 18px;
  font-weight: bold;
  color: #1890ff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}

.sidebar-header {
  display: flex;
  align-items: center;
  justify-content: center;
  //border-bottom: 1px solid #e5e5e5;
  background-color: #fff;
  flex-shrink: 0;
  width: 100%;
  box-sizing: border-box;
  min-height: 48px; // ‰∏éÂè≥‰æßÂ∑•ÂÖ∑Ê†èÈ´òÂ∫¶ÂåπÈÖç

  .arco-tabs-content {
    padding-top: 0 !important;
  }
}

.sidebar-tabs {
  flex: 0 0 auto;
  width: 100%;

  .tabs {
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    background-color: red;

    .arco-tabs-nav-tab {
      display: flex;
      justify-content: center;
      background-color: red;
    }
  }
}

//// ËÆ©tabsÊ†áÁ≠æÂÜÖÂÆπÂ±Ö‰∏≠
//:deep(.sidebar-tabs .arco-tabs-nav) {
//  justify-content: center;
//}
//
//:deep(.sidebar-tabs .arco-tabs-nav-tab-list) {
//  justify-content: center;
//}

.tab-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  width: 100%;
  max-width: 100%;
}

.category-filter {
  padding: 0 16px; // Â¢ûÂä†‰∏ä‰∏ãÈó¥Ë∑ù
  padding-bottom: 8px;
  //border-bottom: 1px solid #f0f0f0;
  width: 100%;
  box-sizing: border-box;
  flex-shrink: 0;
  //margin-top: 8px; // ‰∏éÊ†áÁ≠æÈ°µ‰πãÈó¥Â¢ûÂä†Èó¥Ë∑ù
}

.category-actions {
  padding: 16px 16px; // Áªü‰∏ÄÈó¥Ë∑ù
  border-bottom: 1px solid #f0f0f0;
  width: 100%;
  box-sizing: border-box;
  margin-top: 8px; // ‰∏éÊ†áÁ≠æÈ°µ‰πãÈó¥Â¢ûÂä†Èó¥Ë∑ù
}

.session-list,
.category-list {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden; // Á¶ÅÊ≠¢Ê∞¥Âπ≥ÊªöÂä®
  padding: 8px 0;
  width: 100%;
  box-sizing: border-box;
}

.session-footer {
  padding: 16px 16px 16px 16px; // Áªü‰∏ÄÂÜÖËæπË∑ùÔºåÁ°Æ‰øù‰∏éÂ∑¶Âè≥ËæπÁïåÁõ∏Á≠â
  border-top: 1px solid #f0f0f0;
  background-color: #fff;
  width: 100%;
  box-sizing: border-box;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.session-item,
.category-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  cursor: pointer;
  transition: background-color 0.2s;
  min-height: 60px;
  // Ê≠£Á°ÆÁöÑÂÆΩÂ∫¶ÊéßÂà∂
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;

  &:hover {
    background-color: #f5f5f5;
  }

  &.active {
    background-color: #e6f7ff;
    border-right: 3px solid #1890ff;
  }
}

.session-footer {
  .arco-btn {
    width: 100%;
  }
}

.session-info,
.category-info {
  flex: 1;
  min-width: 0; // ÂÖÅËÆ∏Êî∂Áº©
  overflow: hidden;
  padding-right: 8px;
  // Âº∫Âà∂ÊñáÊú¨Êç¢Ë°åÂíåË£ÅÂâ™
  word-break: break-all;
  word-wrap: break-word;
  box-sizing: border-box;
}

// Á°Æ‰øù‰∏ãÊãâÊåâÈíÆÂõ∫ÂÆö‰ΩçÁΩÆÂíåÂ§ßÂ∞è
.category-item .arco-dropdown,
.session-item .arco-dropdown {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  display: flex;
  justify-content: center;
  align-items: center;
}

// Á°Æ‰øùÊåâÈíÆÊú¨Ë∫´ÂèØÁÇπÂáª
.category-item .arco-dropdown .arco-btn,
.session-item .arco-dropdown .arco-btn {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: auto;
  min-width: 0;
}

.session-title,
.category-name {
  font-weight: 500;
  margin-bottom: 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  // ‰∏•Ê†ºÂÆΩÂ∫¶ÊéßÂà∂
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  min-width: 0; // ÂÖÅËÆ∏Êî∂Áº©
}

.session-meta {
  display: flex;
  flex-direction: column;
  gap: 2px;
  font-size: 12px;
  color: #666;
  width: 100%;
  max-width: 100%;
  overflow: hidden;
  min-width: 0; // ÂÖÅËÆ∏Êî∂Áº©
}

.session-time {
  color: #999;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 100%;
  min-width: 0;
}

.session-summary {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  min-width: 0; // ÂÖÅËÆ∏Êî∂Áº©
}

.category-count {
  font-size: 12px;
  color: #999;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  width: 100%;
  min-width: 0;
}

// ‰øÆÂ§çarco-spinÂØºËá¥ÁöÑÂÆΩÂ∫¶ÈóÆÈ¢ò
:deep(.arco-spin) {
  display: block !important; // Ë¶ÜÁõñÈªòËÆ§ÁöÑinline-block
  width: 100% !important;
}

// Âç±Èô©Êìç‰ΩúÊ†∑Âºè
:deep(.arco-dropdown-option.danger) {
  color: #f5222d;
  
  &:hover {
    background-color: #fff2f0;
  }
}
</style>